<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title></title>

	<style type="text/css">
		
		html,body {
			padding: 0;
			margin: 0;
			font-family: arial, sans-serif;
		}

		.g-chart {
			padding-right: 20px;
			padding-left: 20px;
			max-width: 1050px;
			margin: 50px auto;
		}

		.g-chart-cont {
			margin-bottom: 25px;
		}

		svg {
			overflow: visible;
		}

		text {
			font-size: 12px;
		}

		.g-title {
			font-weight: 700;
			margin-bottom: 5px;
			font-size: 14px;
		}

		path.domain {
			stroke: #d3d3d3;
		}

		.x.axis {
			font-size: 9px;
		}

		.x.axis line {
			stroke: #999;
		}

		.x.axis text {
			fill: #999;
		}

		.tooltip {
		  top: -1000px;
		  position: fixed;
		  padding: 10px;
		  background: rgba(255, 255, 255, .90);
		  border: 1px solid lightgray;
		  pointer-events: none;
		}
		.tooltip-hidden{
		  opacity: 0;
		  transition: all .3s;
		  transition-delay: .1s;
		}

		@media (max-width: 590px){
		  div.tooltip{
		    bottom: -1px;
		    width: calc(100%);
		    left: -1px !important;
		    right: -1px !important;
		    top: auto !important;
		    width: auto !important;
		  }
		}

		circle {
			stroke: #fff;
			fill: rgba(255,0,0,0.3);
		}

		circle.tooltipped {
			stroke: #000;
			stroke-width: 2;
		}

	</style>
</head>
<body>

	<div class="g-chart"></div>

	<script src="https://kklai.github.io/js/d3_.js"></script>
	<script type="text/javascript">
		
		d3.select('body').selectAppend('div.tooltip')
		d3.loadData("aig-data.csv", function(err, res){

			let data = res[0];
			let keywords = d3.nest().key(d => d.keyword).entries(data)
			let cont = d3.select(".g-chart").html("");
			let width = cont.node().getBoundingClientRect().width;
			let height = 50;
			let margin = {
				top: 5,
				left: 60,
				bottom: 0,
				right: 0
			}

			data.forEach(function(d,i){
				data[i]["TD-DOA"] = +d["TD-DOA"];
			})
			let extent = d3.extent(data.map(d => d["TD-DOA"]));
			let x = d3.scaleLinear().domain([0,extent[1]]).range([0,width-margin.left-margin.right]);
			let xAxis = d3.axisBottom(x).tickValues([0,500,1000,1500,2000,2500]);

			let group2vals = ["Normal", "DS", "Legal"];

			keywords.forEach(function(group){

				let keyword = group.key;
				let sel = cont.append("div.g-chart-cont");

				sel.append("div.g-title").text(keyword);

				let svg = sel.append("svg").attr("width", width).attr("height", height).append("g").translate([0,margin.top]);

				group2vals.forEach(function(group2,i){
					let g = svg.append("g").translate([0,i*15]);
					let filtered = group.values.filter(d => d.group == group2);

					g.append("text")
						.translate([0,2])
						.text(group2)

					let g2 = g.append("g").translate([margin.left,0])
					g2.appendMany("circle", filtered)
						.attr("r", 4)
						.translate(d => [x(d["TD-DOA"]),0])
						.call(d3.attachTooltip)
						.on('mouseover', function(d){
							d3.select(this).raise()
						})


					if (i == 2) {
						g2.append("g.x.axis")
							.translate([0,5])
							.call(xAxis)
					}
				})

				



			})


		})

	</script>
</body>
</html>