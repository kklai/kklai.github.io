<style>
.g-body {
  max-width: none;
  margin: 0 auto;
  padding: 0;
  width: 100%;
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  color: #444;
}
.g-kicker {
  text-align: center;
  margin-bottom: 20px;
}
.g-kicker .g-inner {
  display: inline;
  padding: 0 2px 5px 2px;
  border-bottom: 1px solid #d3d3d3;
}
.g-header .g-headline {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  font-weight: 700;
  margin: 0 auto 25px auto;
  font-size: 32px;
  line-height: 1.8;
  max-width: 720px;
}
.g-subhed {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  font-weight: 700;
  margin: 60px auto 25px auto;
  font-size: 24px;
  max-width: 600px;
}
.g-text {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
  max-width: 600px;
  margin: 16px auto;
  font-size: 16px;
  line-height: 1.8;
  color: #444;
}
.g-bold {
  font-weight: 700;
}
.g-graphic {
  margin: 25px auto;
}
.g-graphic-text {
  font-family: droid sans, helvetica neue, Helvetica, Arial, sans-serif;
}
.g-image {
  margin: 35px auto;
}
.g-image img {
  width: 100%;
  display: block;
  margin: 0 auto;
}
.g-image .g-credit {
  margin-top: 10px;
  font-size: 13px;
  text-align: center;
  color: #999;
  display: block;
}
.g-refer {
  border: 1px solid #ececec;
  border-radius: 5px;
  background: rgba(0, 0, 0, 0.1);
  padding: 10px 15px;
  max-width: 600px;
  margin: 20px auto !important;
  display: block;
}
.g-refer.g-text {
  font-size: 14px;
  line-height: 1.5;
}
.g-refer.g-text:first-child {
  margin-bottom: 5px;
  font-weight: 700;
}
.g-refer .g-bullet:before {
  content: "•";
  position: absolute;
  margin-left: -10px;
}
.g-break {
  margin: 50px auto;
  text-align: center;
}
.g-break em {
  margin-right: 40px;
  text-align: center;
}
.g-break em:last-child {
  margin-right: 0;
}
.cover-image-wrapper.mobile,
.author-wrapper {
  display: none !important;
}
.g-promo {
  max-width: 600px;
  margin: 25px auto;
  padding: 25px 0;
  border-top: 1px solid #ddd;
  border-bottom: 1px solid #ddd;
}
.g-promo a {
  color: #444;
  text-decoration: none;
  transition: opacity 0.2s;
}
.g-promo a:hover {
  opacity: 0.6;
}
.g-promo .g-promo-asset-cont,
.g-promo .g-promo-text-cont {
  display: inline-block;
  width: 100%;
  vertical-align: top;
}
@media screen and (min-width: 600px) {
  .g-promo .g-promo-asset-cont {
    width: calc(68% - 10px);
  }
}
@media screen and (min-width: 600px) {
  .g-promo .g-promo-text-cont {
    width: calc(32% - 10px);
  }
}
.g-promo .g-promo-text-cont {
  margin-right: 10px;
}
.g-promo .g-promo-tag {
  font-weight: 700;
  margin-bottom: 3px;
}
.g-promo .g-promo-hed {
  font-weight: 700;
  margin-bottom: 10px;
}
@media screen and (min-width: 460px) {
  .g-promo .g-promo-hed {
    max-width: none;
  }
}
.g-promo .g-promo-text {
  margin-bottom: 10px;
  font-size: 15px;
  padding: 0 16px;
}
@media screen and (min-width: 460px) {
  .g-promo .g-promo-text {
    padding: 0;
  }
}
.g-promo .g-youtube-cont {
  width: 100%;
  padding-bottom: 56%;
  position: relative;
}
.g-promo .g-youtube-cont iframe {
  position: absolute;
  top: 0;
  left: 0;
}
.g-promo .g-img-cont img {
  width: 100%;
}
.g-promo .g-mobile-hed {
  display: inline;
}
@media screen and (min-width: 460px) {
  .g-promo .g-mobile-hed {
    display: none;
  }
}
.g-promo .g-desktop-hed {
  display: none;
}
@media screen and (min-width: 460px) {
  .g-promo .g-desktop-hed {
    display: block;
  }
}
.g-note {
  font-size: 13px;
  line-height: 1.5;
  margin-top: 10px !important;
  color: #999;
}
.social-wrap.hidden-print,
.mobile-ad.article-top-ad.center {
  display: none !important;
}
.article-blog-page .related-articles {
  width: 100%;
}
.header-wrap.container {
  display: none !important;
}
.articles {
  padding: 0 !important;
}
.col-xs-12 {
  padding: 0;
}
.container.blog-container {
  width: 100%;
}
.page-content {
  padding: 0 !important;
}
.today-articles-outer-wrapper {
  display: none !important;
}
.article-page .article-content-wrap {
  padding-top: 0 !important;
  margin-top: -5px;
}
.article-page .article-content-wrap .date,
.article-page .article-content-wrap .article-name {
  display: none !important;
}
@media screen and (max-width: 767px) {
  .article-page .article-content-wrap .date,
  .article-page .article-content-wrap .article-name {
    display: none !important;
  }
}
html,
body {
  background: #333;
  margin: 0;
  position: relative;
}
.g-body {
  position: relative;
}
.g-graphic {
  margin: 0;
  position: relative;
}
.g-flightpath {
  background: #333;
  position: relative;
}
.g-flightpath .g-sticky-graphic {
  position: sticky;
  top: 0;
  width: 100%;
  height: 100vh;
}
.g-flightpath .g-sticky-graphic .g-sticky-inner {
  width: 100%;
  height: 100vh;
}
.g-flightpath .g-sticky-graphic text {
  font-size: 14px;
}
.g-flightpath .g-sticky-graphic path {
  stroke-linecap: round;
  stroke-linejoin: round;
}
.g-flightpath .g-sticky-graphic .g-desktop {
  display: none;
}
@media screen and (min-width: 460px) {
  .g-flightpath .g-sticky-graphic .g-desktop {
    display: block;
  }
}
@media screen and (min-width: 460px) {
  .g-flightpath .g-sticky-graphic .g-mobile {
    display: none;
  }
}
.g-flightpath .g-sticky-graphic .g-points {
  opacity: 1;
  transition: opacity 0.5s;
}
.g-flightpath .g-sticky-graphic .g-points.g-hide {
  opacity: 0;
}
.g-flightpath .g-sticky-graphic .gblvb_dot circle,
.g-flightpath .g-sticky-graphic .heli_dot circle,
.g-flightpath .g-sticky-graphic .boat_dot circle {
  stroke: #fff;
  stroke-width: 2;
}
.g-flightpath .g-sticky-graphic .gblvb_dot text,
.g-flightpath .g-sticky-graphic .heli_dot text,
.g-flightpath .g-sticky-graphic .boat_dot text {
  fill: #000;
  font-size: 13px;
}
.g-flightpath .g-sticky-graphic .gblvb_dot {
  fill: #ffcc00;
}
.g-flightpath .g-sticky-graphic .gblvb_dot.g-flash {
  animation: planeflash 2s infinite;
}
@keyframes planeflash {
  0% {
    fill: #ffcc00;
  }
  50% {
    fill: #fff;
  }
  100% {
    fill: #ffcc00;
  }
}
.g-flightpath .g-sticky-graphic .heli_dot {
  fill: #61c6ae;
}
.g-flightpath .g-sticky-graphic .heli_dot.g-flash {
  animation: heliflash 2s infinite;
}
@keyframes heliflash {
  0% {
    fill: #61c6ae;
  }
  50% {
    fill: #fff;
  }
  100% {
    fill: #61c6ae;
  }
}
.g-flightpath .g-sticky-graphic .boat_dot {
  fill: #ff705f;
}
.g-flightpath .g-sticky-graphic .boat_dot.g-flash {
  animation: boatflash 2s infinite;
}
@keyframes boatflash {
  0% {
    fill: #ff705f;
  }
  50% {
    fill: #fff;
  }
  100% {
    fill: #ff705f;
  }
}
.g-flightpath .g-sticky-graphic .gblvb_dot.g-hide,
.g-flightpath .g-sticky-graphic .boat_dot.g-hide {
  opacity: 0;
}
.g-flightpath .g-sticky-graphic .g-flight-path {
  fill: none;
  stroke: #ffcc00;
  stroke-width: 2;
  opacity: 0.5;
  transition: opacity 0.5s;
}
.g-flightpath .g-sticky-graphic .g-flight-path.g-boat-path {
  stroke: #fff;
  opacity: 1;
}
.g-flightpath .g-sticky-graphic .g-flight-path.g-heli-path {
  stroke: #61c6ae;
}
.g-flightpath .g-sticky-graphic .g-flight-path.g-boat-path {
  stroke: #ff705f;
}
.g-flightpath .g-sticky-graphic .g-flight-path.g-boat-path-0 {
  stroke-dasharray: 6 10;
}
.g-flightpath .g-sticky-graphic .g-flight-path.g-hide {
  opacity: 0;
}
.g-flightpath .g-text-cont {
  position: relative;
  margin-top: -100vh;
}
.g-flightpath .g-text-cont .g-text-each {
  padding-top: 60vh;
  min-height: 100vh;
  display: block;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner {
  width: calc(90% - 50px);
  max-width: 600px;
  margin: 0 auto;
  padding: 10px 25px;
  border-radius: 3px;
  background: rgba(255, 255, 255, 0.8);
  border: 1px solid #d3d3d3;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner .g-text {
  margin-top: 5px;
  margin-bottom: 5px;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner .g-time {
  margin-top: 0;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner .g-time .g-time-inner {
  color: #000;
  font-weight: 700;
  display: inline;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner strong,
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner em {
  font-weight: normal;
  font-style: normal;
  padding: 2px 5px;
  margin: 0 3px;
  color: #000;
  white-space: nowrap;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner strong {
  background: #ffcc00;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner em {
  background: #ff705f;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner .g-credit {
  font-size: 13px;
  color: #999;
  line-height: 1.5;
}
.g-flightpath .g-text-cont .g-text-each .g-text-each-inner a {
  color: #444;
}
.g-flightpath .g-text-cont .g-text-each .g-q {
  background: rgba(0, 0, 0, 0.4);
  display: inline;
  color: #fff;
  padding: 3px;
  border-radius: 2px;
  margin-right: 5px;
}
.g-flightpath .g-text-cont .g-text-each.g-text-each-0 {
  text-align: center;
}
.g-flightpath .g-text-cont .g-text-each.g-text-each-0 .g-tt {
  font-size: 26px;
  line-height: 1.3;
  font-weight: 700;
}
@media screen and (min-width: 460px) {
  .g-flightpath .g-text-cont .g-text-each.g-text-each-0 .g-tt {
    font-size: 44px;
  }
}
.g-flightpath .g-text-cont .g-text-each.g-text-each-11 {
  height: auto;
  min-height: 100vh;
}
.g-flightpath .g-text-cont .g-text-each.g-text-each-11 .g-text-each-inner {
  width: calc(100% - 25px);
  padding-top: 20vh;
  background: linear-gradient(rgba(255, 255, 255, 0), #ffffff 20%);
  border: none;
}
@media screen and (min-width: 460px) {
  .g-flightpath .g-text-cont .g-text-each.g-text-each-11 .g-text-each-inner {
    width: calc(90% - 50px);
    padding-top: 10px;
    background: rgba(255, 255, 255, 0.8);
    border: 1px solid #d3d3d3;
  }
}
.g-flightpath .g-text-cont .g-text-each.g-highlight-heli .g-text-each-inner strong {
  background: #61c6ae;
}
.article-page .article-content-wrap {
  overflow: visible;
}
.today-articles-outer-wrapper.hidden-print,
.article-photo.article-media {
  display: none;
}
.mobile-ad.article-ad.medium-rectangle {
  display: none !important;
}
.article-content-wrap:first-child .date,
.article-content-wrap:first-child .article-name {
  display: none;
}
.container {
  padding: 0;
}
.ArticleDetail_article--specialLayout__Z5ois header {
  display: none;
}
.ArticleDetailSpecialLayout_contentContainer__3i4U-,
.ArticleDetail_article--specialLayout__Z5ois {
  max-width: none;
}
.ArticleContent_articleContent--specialLayout__1pN84 > .text {
  margin: 0 !important;
}
.ArticleDetail_article__content__BkruN {
  margin: 0;
}
.ArticleDetailSpecialLayout_contentContainer__3i4U-,
.ArticleDetail_article--specialLayout__Z5ois {
  margin: 0;
}
.ArticleContent_articleContent__1VgpH > * ~ *,
.ArticleContent_parsedArticleContent__BqgLM > * ~ * {
  margin-top: 0;
}
.HeaderSubNav_headerSubNav__3_UCL,
.ArticleDetailSpecialLayout_topBannerAd__3g99r,
.ArticleDetail_pageFlip__2JpX2,
.ArticleTags_root__22wDE {
  display: none;
}
.ArticleDetail_pageFlip__2JpX2,
.ArticleTags_root__22wDE {
  max-width: 920px;
  margin: 30px auto;
}
</style>

<script src="https://interactive.thestandnews.com/scripts/d3_.js"></script>

undefined

<script type='application/javascript'>
{function onload() {
window.stopit = d3.timer(function(){
	d3.selectAll(".article-content-wrap:not(:first-child)").remove();
	d3.selectAll(".likecoin-embed:nth-child(n+3)").remove();
	d3.selectAll(".related-articles:nth-child(n+4)").remove();
})

var svg, path, projection, overlay, line, gblvb1, gblvb_dot, boat1, boat2, boat3, heli1, heli2;

	var bb_shape = topojson.feature(bb2, bb2.objects.bb)
	var hkg_shape = topojson.feature(hkg, hkg.objects["hkg-dissolved"]);

	var points = [
		{"name":"pier","lat":22.276689,"long":114.295455, "text": "布袋澳"},
		{"name":"arrest","lat":21.899990,"long":114.883334, "text": "中國海警聲稱<br>快艇被截獲位置", "align": "right"},
		{"name":"airport","lat": 22.29,"long": 113.91, "text": "機場", type: "nobox"},
		// {"name":"flight","lat":22.276689,"long":114.55, "text": "兩架政府飛機<br>8 月 23 日早上<br>的飛行路線", type: "nobox", "fill": "#ffcc00"},
	]

	var boat_points = [
		{
			Latitude: 22.276689,
			Longitude: 114.295455
		},
		{
			Latitude: 22.19248, 
			Longitude: 114.50213
		},
		{
			Latitude: 22.11519,
			Longitude: 114.64045
		},
		{
			Latitude: 22.01888, 
			Longitude: 114.77446
		},
		{
			Latitude: 21.899990,
			Longitude: 114.883334
		}
	]


	var big_labels = [
		{"text": "香港", "lat": 22.416731, "long": 114.090910},
		{"text": "中國", "lat": 22.563085, "long": 114.062662, "type": "desktop"},
		{"text": "中國", "lat": 22.702898, "long": 114.024818, "type": "mobile"}
	];

	var rotated_label = [
		{"text": "香港水域", "lat": 22.4269, "long": 114.4731, rotated: 67, type: "desktop"},
		{"text": "中國領海基線", "lat": 22.26264, "long": 114.95115, rotated: -26, type: "desktop"},
		{"text": "中國領海範圍", "lat": 22.11641, "long": 115.12144, rotated: -26, type: "desktop"},
		{"text": "毗連區（中國有入境管轄權）", "lat": 21.96621, "long": 115.2719, rotated: -26, type: "desktop"},
	]

	drawMap();

	d3.graphScroll()
	  .container(d3.select('.g-flightpath'))
	  .sections(d3.selectAll('.g-text-cont > .g-text-each'))
	  .on('active', function(i){
	    console.log(i + 'th section active') 

	    if (i == 0) {
	    	clearMap();
	    	// unclearMap();

	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide("#g-arrest");
	    	unhide(".gblvb_dot");
	    	unhide(".boat_dot");
	    	unhide(".heli_dot");

	    	drawPathLoop(gblvb0, gblvb_dot, 50000);
	    	drawPathLoop(heli0, heli_dot, 20000);
	    	drawPathLoop(boat0, boat_dot, 20000);
	    }

	    if (i == 1) {
	    	clearMap();

	    	// move everything to starting position
	    	heli_dot.transition().translate(d => projection([blvh[0].Longitude, blvh[0].Latitude]));
	    	boat_dot.transition().translate(d => projection([boat_points[0].Longitude, boat_points[0].Latitude]))
	    	gblvb_dot.transition().translate(d => projection([blvb[0].Longitude, blvb[0].Latitude]));
	    }

	    if (i == 2) {
	    	clearMap();
	    	highlightAirport();
	    }

	    if (i == 3) {
	    	clearMap();
	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide(".gblvb_dot");
	    	drawPath(gblvb1, gblvb_dot);
	    }

	    if (i == 4) {
	    	clearMap();
	    	highlightBoat();

	    	// cut off gblvb1 animation
	    	// move dot to end of glvb1 animation
	    	drawPathEnd(gblvb1, gblvb_dot);

	    }

	    if (i == 5) {
	    	clearMap();
	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide(".gblvb_dot");
	    	unhide(".boat_dot");
	    	unhide(".g-blvb-1");
	    	drawPath(gblvb2, gblvb_dot);
	    	drawPath(boat1, boat_dot, "boat");
	    }

	    if (i == 6) {
	    	clearMap();

	    	// cut off glvb2, boat1
	    	drawPathEnd(gblvb2, gblvb_dot);
	    	drawPathEnd(boat1, boat_dot, "boat");

	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide(".gblvb_dot");
	    	unhide(".boat_dot");
	    	unhide(".g-blvb-1");
	    	unhide(".g-blvb-2");
	    	unhide(".g-boat-1");
	    	drawPath(gblvb3, gblvb_dot);
	    	drawPath(boat2, boat_dot, "boat");


	    	
	    }

	    if (i == 7) {
	    	clearMap();


	    	// cut off glvb2, boat1
	    	drawPathEnd(gblvb3, gblvb_dot);
	    	drawPathEnd(boat1, boat_dot, "boat");
	    	drawPathEnd(boat2, boat_dot, "boat");

	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide(".gblvb_dot");
	    	unhide(".boat_dot");
	    	unhide(".g-blvb-1");
	    	unhide(".g-blvb-2");
	    	unhide(".g-blvb-3");
	    	unhide(".g-boat-1");
	    	unhide(".g-boat-2");
	    	drawPath(gblvb4, gblvb_dot);

	    	unhide(".g-boat-3");
	    	drawPath(boat3, boat_dot, "boat");
	    }

	    if (i == 8) {
	    	clearMap();

	    	drawPathEnd(gblvb4, gblvb_dot);

	    	unhide(".g-boat-3")
	    	drawPathEnd(boat1, boat_dot, "boat");
	    	drawPathEnd(boat2, boat_dot, "boat");
	    	drawPathEnd(boat3, boat_dot, "boat");

	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide(".gblvb_dot");
	    	unhide(".boat_dot");
	    	unhide(".heli_dot");
	    	unhide(".g-blvb-1");
	    	unhide(".g-blvb-2");
	    	unhide(".g-blvb-3");
	    	unhide(".g-blvb-4");
	    	unhide(".g-boat-1");
	    	unhide(".g-boat-2");

	    	heli0.classed("g-hide", true)
	    	heli_dot.classed("g-flash", true)

	    }

	    if (i == 9) {
	    	clearMap();
	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide("#g-arrest");
	    	unhide(".gblvb_dot");
	    	unhide(".boat_dot");
	    	unhide(".heli_dot");
	    	unhide(".g-blvb-1");
	    	unhide(".g-blvb-2");
	    	unhide(".g-blvb-3");
	    	unhide(".g-blvb-4");
	    	unhide(".g-boat-1");
	    	unhide(".g-boat-2");
	    	unhide(".g-boat-3");
	    	unhide(".g-heli-1");
	    	drawPath(heli1, heli_dot);

	    	drawPathEnd(boat1, boat_dot, "boat");
	    	drawPathEnd(boat2, boat_dot, "boat");
	    	drawPathEnd(boat3, boat_dot, "boat");

	    	unhide(".g-boat-4");
	    	drawPath(boat4, boat_dot, "boat");
	    }


	    if (i == 10) {
	    	clearMap();

	    	drawPathEnd(heli1, heli_dot);

	    	drawPathEnd(boat1, boat_dot, "boat");
	    	drawPathEnd(boat2, boat_dot, "boat");
	    	drawPathEnd(boat3, boat_dot, "boat");
	    	drawPathEnd(boat4, boat_dot, "boat");

	    	unhide("#g-airport");
	    	unhide("#g-pier");
	    	unhide("#g-arrest");
	    	unhide(".gblvb_dot");
	    	unhide(".boat_dot");
	    	unhide(".heli_dot");
	    	unhide(".g-blvb-1");
	    	unhide(".g-blvb-2");
	    	unhide(".g-blvb-3");
	    	unhide(".g-blvb-4");
	    	unhide(".g-boat-1");
	    	unhide(".g-boat-2");
	    	unhide(".g-boat-3");
	    	unhide(".g-boat-4");
	    	unhide(".g-heli-1");
	    	drawPath(heli2, heli_dot);
	    }

	    if (i == 11) {
	    	drawPathEnd(heli2, heli_dot);	
	    }

	})
	    
	function unhide(sel) {
		svg.select(sel).classed("g-hide", false);
	}

	function clearMap() {
		svg.selectAll(".g-points").classed("g-hide", true);
		svg.selectAll(".g-points").classed("g-flash", false);
		svg.selectAll(".g-flight-path").classed("g-hide", true);
	}

	function unclearMap() {
		svg.selectAll(".g-points").classed("g-hide", false);
		svg.selectAll(".g-flight-path").classed("g-hide", false);
	}

	function highlightAirport() {
		svg.select("#g-airport").classed("g-hide", false)

		gblvb_dot.classed("g-hide", false)
		gblvb_dot.classed("g-flash", true)

		resetPath(gblvb1, gblvb_dot)


	}

	function highlightBoat() {
		gblvb0.classed("g-hide", true);
		gblvb1.classed("g-hide", false);

		gblvb_dot.classed("g-hide", false);
		

		boat_dot.classed("g-hide", false);
		svg.select("#g-airport").classed("g-hide", false)
		svg.select("#g-pier").classed("g-hide", false)

		boat_dot.classed("g-flash", true)
	}

	function drawPathLoop(thepath, thedot, duration) {
		thepath.classed("g-hide", false);
		var totalLength = thepath.node().getTotalLength();

		// transition();
		// function transition() {
		// 	thepath.attr("stroke-dasharray", totalLength)// + " " + totalLength)
		// 		.attr("stroke-dashoffset", totalLength)
		// 		.transition()
		// 		.duration(duration)
		// 		.attr("stroke-dashoffset", 0)
		// 		.on("end", transition)

		// }
		
		dotTransition();

		function dotTransition() {
			thedot.transition()
				.duration(duration)
				.attrTween("transform", translateAlong(thepath.node()))
				.on("end", dotTransition)	
		}

		 function translateAlong(path) {
		   var l = path.getTotalLength();
		   return function (d) {
		     return function (t) {
	     		var p = path.getPointAtLength(t * l);
	     		return "translate(" + p.x + "," + p.y + ")";
		     }
		   }
		 }
	}

	function drawPath(thepath, thedot, type) {
		thepath.classed("g-hide", false);
		var totalLength = thepath.node().getTotalLength();

		var dashing = "6, 6"
		var dashLength =
		    dashing
		        .split(/[\s,]/)
		        .map(function (a) { return parseFloat(a) || 0 })
		        .reduce(function (a, b) { return a + b });

		var dashCount = Math.ceil( (totalLength) / dashLength );
		var newDashes = new Array(dashCount).join( dashing + " " );
		var dashArray = newDashes + " 10, " + totalLength;

		thepath
			.attr("stroke-dasharray", type == "boat" ? dashArray : totalLength)
			.attr("stroke-dashoffset", totalLength)
			.transition()
			.duration(8000)
			.attr("stroke-dashoffset", 0)

		thedot.transition()
			.duration(8000)
			.attrTween("transform", translateAlong(thepath.node()))

		 function translateAlong(path) {
		   var l = path.getTotalLength();
		   return function (d) {
		     return function (t) {
	     		var p = path.getPointAtLength(t * l);
	     		return "translate(" + p.x + "," + p.y + ")";
		     }
		   }
		 }
	}

	function drawPathEnd(thepath, thedot, type) {
		thepath.classed("g-hide", false);
		var totalLength = thepath.node().getTotalLength();

		var dashing = "6, 6"
		var dashLength =
		    dashing
		        .split(/[\s,]/)
		        .map(function (a) { return parseFloat(a) || 0 })
		        .reduce(function (a, b) { return a + b });

		var dashCount = Math.ceil( totalLength / dashLength );
		var newDashes = new Array(dashCount).join( dashing + " " );
		var dashArray = newDashes + " 0, " + totalLength;

		thepath
			.attr("stroke-dasharray", type == "boat" ? dashArray : totalLength)
			.transition()
			.attr("stroke-dashoffset", 0)

		thedot.transition()
			.attr("transform", translateAlong(thepath.node()))

		 function translateAlong(path) {
		   var l = path.getTotalLength();
		   var p = path.getPointAtLength(1 * l);
		   return "translate(" + p.x + "," + p.y + ")";
		 }
	}


	function resetPath(thepath, thedot, type) {
		var totalLength = thepath.node().getTotalLength();
		var dashing = "6, 6"
		var dashLength =
		    dashing
		        .split(/[\s,]/)
		        .map(function (a) { return parseFloat(a) || 0 })
		        .reduce(function (a, b) { return a + b });

		var dashCount = Math.ceil( totalLength / dashLength );
		var newDashes = new Array(dashCount).join( dashing + " " );
		var dashArray = newDashes + " 0, " + totalLength;

		thepath
			.attr("stroke-dasharray", type == "boat" ? dashArray : totalLength)
			.transition()
			.attr("stroke-dashoffset", totalLength)

		thedot.transition()
			.attr("transform", translateAlong(thepath.node()))

		function translateAlong(path) {
		  var l = path.getTotalLength();
		  var p = path.getPointAtLength(0 * l);
		  return "translate(" + p.x + "," + p.y + ")";
		}
	}


	function drawMap() {
		
		var isMobile = innerWidth < 460;

		var sel = d3.select(".g-sticky-graphic .g-sticky-inner").html("");

		var width = sel.node().getBoundingClientRect().width
		var height = sel.node().getBoundingClientRect().height

		svg = sel.append("svg").attr("width", width).attr("height", height);

		if (isMobile) {
			svg = svg.append("g").translate([0, -innerWidth*0.2])
		}

		projection = d3.geoMercator().fitSize([width*0.8, height], bb_shape)
		path = d3.geoPath().projection(projection);

		var base = svg.append("g.g-base")
		overlay = svg.append("g.g-overlay")

		base.appendMany("path", topojson.feature(hk_water, hk_water.objects.hk_water).features)
			.style("fill", "none")
			.style("stroke", "#ececec")
			.style("opacity", 0.3)
			.attr("d", path)

		base.appendMany("path", topojson.feature(marine, marine.objects.eez).features)
			.style("fill", "none")
			.style("stroke", "#ececec")
			.style("opacity", 0.3)
			.attr("d", path)

		base.appendMany("path", topojson.feature(china, china.objects.CHN_adm0).features)
				.style("fill", "#666")
		        .attr("d", path)

		base.appendMany("path", hkg_shape.features)
				.style("stroke", "#333")
				.style("stroke-width", 2)
				.style("fill", "#999")
		        .attr("d", path)

		base.appendMany("text", big_labels)
			.attr("class", d => "g-" + d.type)
			.style("text-anchor", "middle")
			.translate(d => projection([d.long, d.lat]))
			.style("letter-spacing", isMobile ? 5 : 20)
			.style("opacity", 0.5)
			.text(d => d.text)

		var rl = base.appendMany("g", rotated_label)
		.attr("class", d => "g-" + d.type)
		.style("text-anchor", "middle")
		.translate(d => projection([d.long, d.lat]))

		rl.append("text")
			.attr("transform", d => "translate(10,0) rotate(" +  d.rotated + ")")
			.style("fill", "#fff")
			.style("letter-spacing", 5)
			.style("opacity", 0.3)
			.text(d => d.text)

		
		line = d3.line()
			.curve(d3.curveCardinal)
			.x(function(d) { return projection([d.Longitude, d.Latitude])[0]; })  
			.y(function(d) { return projection([d.Longitude, d.Latitude])[1]; });

		gblvb0 = overlay.append("path")
			.datum(blvb.filter((d,i) => i < blvb.length - 2))
			.attr("class", "g-flight-path")
			.attr("d", d => line(d))

		heli0 = overlay.append("path")
			.datum(blvh)
			.attr("class", "g-flight-path g-heli-path")
			.attr("d", d => line(d))

		boat0 = overlay.append("path")
			.datum(boat_points)
			.attr("class", "g-flight-path g-boat-path g-boat-path-0")
			.attr("d", d => line(d))


		gblvb1 = overlay.append("path")
			.datum(blvb.filter((d,i) => i < 527))
			.attr("class", "g-flight-path g-blvb-1")
			.attr("d", d => line(d))

		gblvb2 = overlay.append("path")
			.datum(blvb.filter((d,i) => i >= 527 && i < 660))
			.attr("class", "g-flight-path g-blvb-2")
			.attr("d", d => line(d))

		gblvb3 = overlay.append("path")
			.datum(blvb.filter((d,i) => i >= 659 && i < 726))
			.attr("class", "g-flight-path g-blvb-3")
			.attr("d", d => line(d))

		gblvb4 = overlay.append("path")
			.datum(blvb.filter((d,i) => i >= 725 && i < 828))
			.attr("class", "g-flight-path g-blvb-4")
			.attr("d", d => line(d))


		heli1 = overlay.append("path")
			.datum(blvh.filter((d,i) => i <= 90))
			.attr("class", "g-flight-path g-heli-path g-heli-1")
			.attr("d", d => line(d))

		heli2 = overlay.append("path")
			.datum(blvh.filter((d,i) => i >= 90))
			.attr("class", "g-flight-path g-heli-path g-heli-2")
			.attr("d", d => line(d))


		boat1 = overlay.append("path.g-flight-path.g-boat-path.g-boat-1")
			.datum([boat_points[0], boat_points[1]])
			.attr("d", d => line(d))

		boat2 = overlay.append("path.g-flight-path.g-boat-path.g-boat-2")
			.datum([boat_points[1], boat_points[2]])
			.attr("d", d => line(d))

		boat3 = overlay.append("path.g-flight-path.g-boat-path.g-boat-3")
			.datum([boat_points[2], boat_points[3]])
			.attr("d", d => line(d))

		boat4 = overlay.append("path.g-flight-path.g-boat-path.g-boat-4")
			.datum([boat_points[3], boat_points[4]])
			.attr("d", d => line(d))

		var pt = overlay.appendMany("g", points)
			.attr("class", "g-points")
			.attr("id", d => "g-" + d.name)
			.translate(function(d){
				var pos = projection([d.long, d.lat])
				return [pos[0]-5, pos[1]-5]
			})

		pt.append("rect")
			.attr("width", d => d.type == "nobox" ? 0 : 10)
			.attr("height", d => d.type == "nobox" ? 0 : 10)
			.style("fill", "#fff")

		pt.append("text")
			.style("fill", d => d.fill ? d.fill : "#fff")
			.style("text-shadow", "0px 0px 3px #000")
			.style("text-anchor", d => d.align == "right" ? "end" : "start")
			.translate(d => d.align ? [-5,-7] : [0,-7])
			.tspans(d => d.text.split("<br>"),20)

		gblvb_dot = overlay.append("g.gblvb_dot.g-points")
			.translate(d => projection([blvb[0].Longitude, blvb[0].Latitude]));

		gblvb_dot.append("circle").attr("r", 6)
		gblvb_dot.append("rect").attr("width", 50).attr("height", 20).translate([10,-11])
		gblvb_dot.append("text").text("定翼機").translate([16,4])


		heli_dot = overlay.append("g.heli_dot.g-points")
			.translate(d => projection([blvh[0].Longitude, blvh[0].Latitude]));

		heli_dot.append("circle").attr("r", 6)
		heli_dot.append("rect").attr("width", 50).attr("height", 20).translate([10,-11])
		heli_dot.append("text").text("直升機").translate([16,4])

		boat_dot = overlay.append("g.boat_dot.g-points")
			.translate(d => projection([boat_points[0].Longitude, boat_points[0].Latitude]));

		boat_dot.append("circle").attr("r", 6)
		boat_dot.append("rect").attr("width", 38).attr("height", 20).translate([10,-11])
		boat_dot.append("text").text("快艇").translate([16,4])

	
	}




var containerWidthChanged = false;
var ow = innerWidth;

window.addEventListener("resize", function(){
	if (innerWidth != ow) {
	    containerWidthChanged = true;
	    ow = innerWidth;
	    drawMap();
	  }
});



}window.addEventListener('load', onload);
}
</script>