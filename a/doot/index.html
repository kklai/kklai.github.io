<meta charset="utf-8">
<style>
.g-body {
  margin: 0 auto;
  padding: 0;
  width: 100%;
  font-family: PingFang HK, Noto Sans TC, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
  color: #444;
}
.g-kicker {
  text-align: center;
  margin-bottom: 20px;
}
.g-kicker .g-inner {
  display: inline;
  padding: 0 2px 5px 2px;
  border-bottom: 1px solid #d3d3d3;
}
.g-header .g-headline {
  font-family: PingFang HK, Noto Sans TC, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
  font-weight: 700;
  margin: 0 auto 25px auto;
  font-size: 32px;
  line-height: 1.8;
  max-width: 720px;
}
.g-subhed {
  font-family: PingFang HK, Noto Sans TC, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
  font-weight: 700;
  margin: 60px auto 25px auto;
  font-size: 24px;
  max-width: 600px;
}
.g-text {
  font-family: PingFang HK, Noto Sans TC, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
  max-width: 600px;
  margin: 16px auto;
  font-size: 16px;
  line-height: 1.8;
  color: #444;
}
.g-bold {
  font-weight: 700;
}
.g-graphic {
  margin: 25px auto;
}
.g-graphic-text {
  font-family: PingFang HK, Noto Sans TC, -apple-system, BlinkMacSystemFont, Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif, Apple Color Emoji, Segoe UI Emoji, Segoe UI Symbol, Noto Color Emoji;
}
.g-image {
  margin: 35px auto;
}
.g-image img {
  width: 100%;
  display: block;
  margin: 0 auto;
}
.g-image .g-credit {
  margin-top: 10px;
  font-size: 13px;
  text-align: center;
  color: #999;
  display: block;
}
.g-refer {
  border: 1px solid #ececec;
  border-radius: 5px;
  background: rgba(253, 232, 0, 0.05);
  padding: 10px 20px;
  max-width: 460px;
  margin: 35px auto;
}
.g-refer .g-text {
  font-size: 12px;
  margin: 0;
  line-height: 1.5;
}
.g-refer .g-text:first-child {
  margin-bottom: 5px;
  font-weight: 700;
}
.g-refer .g-bullet:before {
  content: "â€¢";
  position: absolute;
  margin-left: -10px;
}
.g-break {
  margin: 50px auto;
  text-align: center;
}
.g-break em {
  margin-right: 40px;
  text-align: center;
}
.g-break em:last-child {
  margin-right: 0;
}
.cover-image-wrapper.mobile,
.author-wrapper {
  display: none !important;
}
.g-promo {
  max-width: 600px;
  margin: 25px auto;
  padding: 25px 0;
  border-top: 1px solid #ddd;
  border-bottom: 1px solid #ddd;
}
.g-promo a {
  color: #444;
  text-decoration: none;
  transition: opacity 0.2s;
}
.g-promo a:hover {
  opacity: 0.6;
}
.g-promo .g-promo-asset-cont,
.g-promo .g-promo-text-cont {
  display: inline-block;
  width: 100%;
  vertical-align: top;
}
@media screen and (min-width: 600px) {
  .g-promo .g-promo-asset-cont {
    width: calc(68% - 10px);
  }
}
@media screen and (min-width: 600px) {
  .g-promo .g-promo-text-cont {
    width: calc(32% - 10px);
  }
}
.g-promo .g-promo-text-cont {
  margin-right: 10px;
}
.g-promo .g-promo-tag {
  font-weight: 700;
  margin-bottom: 3px;
}
.g-promo .g-promo-hed {
  font-weight: 700;
  margin-bottom: 10px;
}
@media screen and (min-width: 460px) {
  .g-promo .g-promo-hed {
    max-width: none;
  }
}
.g-promo .g-promo-text {
  margin-bottom: 10px;
  font-size: 15px;
  padding: 0 16px;
}
@media screen and (min-width: 460px) {
  .g-promo .g-promo-text {
    padding: 0;
  }
}
.g-promo .g-youtube-cont {
  width: 100%;
  padding-bottom: 56%;
  position: relative;
}
.g-promo .g-youtube-cont iframe {
  position: absolute;
  top: 0;
  left: 0;
}
.g-promo .g-img-cont img {
  width: 100%;
}
.g-promo .g-mobile-hed {
  display: inline;
}
@media screen and (min-width: 460px) {
  .g-promo .g-mobile-hed {
    display: none;
  }
}
.g-promo .g-desktop-hed {
  display: none;
}
@media screen and (min-width: 460px) {
  .g-promo .g-desktop-hed {
    display: block;
  }
}
.g-note {
  font-size: 13px;
  text-align: center;
  color: #999;
}
html,
body {
  background: #00ac4e;
  margin: 0;
  padding: 0;
}
.g-body {
  position: fixed;
  top: 28px;
  left: 0;
  width: 100%;
  height: 100%;
  padding-top: 20px;
}
@media screen and (max-width: 600px) {
  .g-body {
    top: 33px;
  }
}
.g-body video {
  user-select: none;
  pointer-events: none;
}
.g-body .g-gameover,
.g-body .g-start-button {
  display: none;
  width: 100%;
  height: 100%;
  background: rgba(0, 0, 0, 0.6);
  z-index: 10;
  position: absolute;
  top: 0;
  left: 0;
}
.g-body .g-gameover img,
.g-body .g-start-button img {
  padding-top: 40vh;
}
.g-body .g-gameover.g-active,
.g-body .g-start-button.g-active {
  display: block;
  z-index: 100;
}
.g-body .g-gameover img:last-child {
  padding-top: 0;
}
.g-body .g-start-button {
  z-index: 11;
}
.g-body .g-start-button:hover {
  cursor: pointer;
}
.g-body .g-start-button .g-instructions {
  position: absolute;
  width: 100%;
  height: 100%;
  top: 0;
}
.g-body .g-start-button .g-instructions img {
  width: 100%;
  padding-top: 0;
}
.g-body .g-start-button .g-instructions .g-img-cont {
  border: 1px solid #fff;
  border-radius: 100%;
  box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.3);
  background: rgba(255, 255, 255, 0.2);
  opacity: 0.6;
  width: 90%;
  left: 5%;
  padding-top: 0;
  position: absolute;
  bottom: 20px;
}
.g-body .g-start-button .g-instructions .g-i-each {
  position: absolute;
  bottom: 0;
  left: 0;
  width: 33%;
  height: 100%;
}
.g-body .g-start-button .g-instructions .g-i-1 {
  left: 33%;
}
.g-body .g-start-button .g-instructions .g-i-2 {
  left: 66%;
}
.g-body .g-score {
  position: absolute;
  top: 20px;
  left: 20px;
}
.g-body .g-score .g-s {
  color: #fff;
}
.g-body .g-score .g-s img {
  width: 80px;
  display: inline-block;
  vertical-align: middle;
}
.g-body .g-score .g-n {
  display: inline-block;
  vertical-align: middle;
  margin-left: 3px;
  color: #ffd910;
  font-weight: 700;
  font-size: 20px;
}
.g-body .g-body-inner {
  max-width: 460px;
  margin: 0 auto;
  position: relative;
  width: calc(100% - 15px);
  height: calc(100% - 40px);
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 10px;
  overflow: hidden;
}
.g-body .g-main {
  width: 80%;
}
.g-body img {
  width: 100%;
}
.g-body .g-door {
  width: 100px;
  margin: 0 auto;
  z-index: 4;
  background: #00ac4e;
}
.g-body .g-man {
  width: 60px;
  position: absolute;
  bottom: 0;
}
.g-body .g-overlay-svg {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 3;
}
.g-body .g-shot {
  fill: #ffd617;
}
.g-body .g-dootsound {
  display: none;
}
.g-body .g-buttons {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: 10;
}
.g-body .g-buttons img {
  width: 100%;
  padding-top: 0;
}
.g-body .g-buttons .g-img-cont {
  border: 1px solid #fff;
  border-radius: 100%;
  box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.3);
  background: rgba(255, 255, 255, 0.2);
  opacity: 0.6;
  width: 90%;
  left: 5%;
  padding-top: 0;
  position: absolute;
  bottom: 20px;
}
.g-body .g-buttons .g-button {
  position: absolute;
  width: 33%;
  height: 100%;
}
.g-body .g-buttons .g-shoot {
  left: 33%;
}
.g-body .g-buttons .g-right {
  left: 66%;
}
#article_details_top_banner_desktop,
.ArticleDetail_articleShareWidget__1M_8z,
.ArticleDetail_article--specialLayout__Z5ois header,
.ArticleTags_root__22wDE,
.LikeCoinButton_likeCoinButton__11znt,
.ArticleDetailSpecialLayout_articleDetail__relatedArticlesContainer__1Rlzq,
.ArticleDetail_pageFlip__2JpX2,
.ArticleDetail_bottomAd__1pMho,
.HeaderSubNav_headerSubNav__3_UCL,
.Footer_footer__1_KSh,
.ArticleDetail_postCommentButtonContainer__PoXtv {
  display: none;
}
</style>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=VT323&display=swap" rel="stylesheet"><div class="g-body"><div class="g-body-inner"><div class="g-score"><div class="g-s"><img src="https://interactive.thestandnews.com/2021/11/leavehome/score.png?xdfcghv"><div class="g-n">0</div></div></div><div class="g-door"><img src="https://interactive.thestandnews.com/2021/11/leavehome/door.jpg"></div><div class="g-main"></div><div class="g-man"><img src="https://interactive.thestandnews.com/2021/11/leavehome/man.jpg"></div><div class="g-overlay-svg"></div><div class="g-gameover"><img src="https://interactive.thestandnews.com/2021/11/leavehome/gameover.png"><img src="https://interactive.thestandnews.com/2021/11/leavehome/replay.png"></div><div class="g-start-button g-active"><img src="https://interactive.thestandnews.com/2021/11/leavehome/start.png"></div><video playsinline class="g-dootsound" src="https://interactive.thestandnews.com/2021/11/leavehome/doot_1.mp4"></video><div class="g-buttons"><div class="g-button g-left" data-id="left"><div class="g-img-cont"><img src="https://interactive.thestandnews.com/2021/11/leavehome/left.png"></div></div><div class="g-button g-shoot" data-id="shoot"><div class="g-img-cont"><img src="https://interactive.thestandnews.com/2021/11/leavehome/shoot.png"></div></div><div class="g-button g-right" data-id="right"><div class="g-img-cont"><img src="https://interactive.thestandnews.com/2021/11/leavehome/right.png"></div></div></div></div></div><script src="https://interactive.thestandnews.com/scripts/d3_.js"></script>
<script>
// window.stopit = d3.timer(function(){
// 	d3.selectAll(".article-content-wrap:not(:first-child)").remove();
// 	d3.selectAll(".likecoin-embed:nth-child(n+3)").remove();
// 	d3.selectAll(".related-articles:nth-child(n+4)").remove();
// })


// var containerWidthChanged = false;
// var ow = innerWidth;

// window.addEventListener("resize", function(){
// 	if (innerWidth != ow) {
// 	    containerWidthChanged = true;
// 	    ow = innerWidth;
// 	    redraw();
// 	  }
// });


var sel = d3.select(".g-main").html("");
var door = d3.select(".g-door");
var man = d3.select(".g-man");
var manheight = 60*171/141;
var width = d3.select(".g-body-inner").node().getBoundingClientRect().width;
var height = d3.select(".g-body-inner").node().getBoundingClientRect().height;
var svg = d3.select(".g-overlay-svg").html("").append("svg").attr("width", width).attr("height", height);
width -= 20;
var topoffset = door.node().getBoundingClientRect().width;
svg = svg.append("g").translate([10,0])
var shots = [];
var rowg = svg.append("g");

var col = 10;
var w = width/col;
var h = w*69.85/55.12;
var deadpoint = height - manheight - h + 10;

var score = 0;
var scoreel = d3.select(".g-n");
var dootsound = d3.select(".g-dootsound").node();

function shoot() {
	var left = +man.style("left").replace("px", "") + 7;
	var top = man.node().getBoundingClientRect().top - topoffset - 5;
	var shot = svg.append("rect.g-shot").attr("width", 2).attr("height", 10);
	shot.translate([left,top])
	shots.push(shot);
}

function moveman(dir) {
	var step = 15;
	var left = +man.style("left").replace("px", "");
	if (dir == "right") {
		if ((+left + 15 + 20) < width) {
			left += 15;
		}
	} else {
		if ((+left - 15) > 0) {
			left -= 15;
		}
	}
	man.style("left", left + "px");
}


function addRow() {
	var g = rowg.append("g.g-row").translate([0,topoffset]);
	for (var i = 0; i < col; i++) {
		g.append("image")
			.attr("href", "https://interactive.thestandnews.com/2021/11/leavehome/doot.jpg")
			.translate([i*w,0])
			.attr("width", w)
			.attr("height", h);
	}
}


function gameover() {
	d3.select(".g-gameover").classed("g-active", true)
	window.timer.stop();

	d3.select(".g-gameover").on("click", function(){
		d3.select(".g-gameover").classed("g-active", false);
		start();
	})
}


d3.select(".g-start-button").on("click", function(){
	d3.select(this).classed("g-active", false)
	start();
})



function start() {
	man.style("left", (width/2 - 60/2) + "px")
	svg.selectAll(".g-row").remove();;
	addRow();
	var rowcounter = 0;
	var speed = 20;
	var increment = 5;
	var increasecounter = 0;
	var score = 0;
	scoreel.html("0")

	d3.selectAll(".g-img-cont").style("opacity", 0.1)

	window.timer = d3.timer(function(){

		d3.selectAll(".g-shot").each(function(){
			var el = d3.select(this);
			var translate = el.attr("transform");
			var left = translate.split("(")[1].split(",")[0]
			var top = translate.split("(")[1].split(",")[1].replace(")", "");
			el.translate([left, top-10]);

			if (top < 0) {
				el.remove();
			}

			var rect1el = el;
			var rect1 = el.node().getBoundingClientRect();

			if (!rect1el.attr("used")) {
				d3.selectAll("image").each(function(){
					var el = d3.select(this);
					var rect2 = el.node().getBoundingClientRect();
					var overlap = !(rect1.right < rect2.left || 
					                rect1.left > rect2.right || 
					                rect1.bottom < rect2.top || 
					                rect1.top > rect2.bottom)

					if (overlap) {
						rect1el.attr("used", true);

						var parent = d3.select(this.parentNode);
						if (parent) {
							if (parent.attr("transform")) {
								var atop = parent.attr("transform").split("(")[1].split(",")[1].replace(")", "");
								var aleft = el.attr("transform").split("(")[1].split(",")[0];
								var a = svg.append("image").attr("href", "https://interactive.thestandnews.com/2021/11/leavehome/explode.png").translate([aleft, atop]).attr("width", w).attr("height", h);

								setTimeout(function(){
									a.remove();
								},150)
							}
						}
						
						


						el.remove();
						score += 1;
						scoreel.html(score);
						dootsound.play();
					}
				})
			} else {
				rect1el.remove();
			}
			


		})

		rowcounter += 1;
		if (rowcounter == speed) {
			d3.selectAll(".g-row").each(function(el,i){
				var el = d3.select(this);
				if (el.select("image").empty()) {
					el.remove();
				} else {
					var translate = el.attr("transform");
					var left = +translate.split("(")[1].split(",")[0]
					var top = +translate.split("(")[1].split(",")[1].replace(")", "");
					el.translate([0, top+increment]);
					if (top > deadpoint) {
						gameover();
					}
				}
			})
			rowcounter = 0;
		}

		if (d3.select(".g-row").empty()) {
			addRow();
		}

		var firstrow = d3.select(".g-row:last-child");
		var top = +firstrow.attr("transform").split("(")[1].split(",")[1].replace(")", "");
		if (top > (topoffset+h)) {
			addRow();
		}

		// if (increasecounter == 200) {
		// 	increment += 1;
		// 	increasecounter = 0;
		// }
		// increasecounter += 1;
	})
	document.onkeydown = checkKey;

	d3.selectAll(".g-button").on("click", function(){
		var el = d3.select(this).attr("data-id");
		if (el == "left") {
			moveman();
		} else if (el == "shoot") {
			shoot();
		} else if (el == "right") {
			moveman("right");	
		}
	})

	function checkKey(e) {

	    e = e || window.event;

	    if (e.keyCode == '37') {
	       // left arrow
			moveman();
	    }
	    else if (e.keyCode == '39') {
	       // right arrow
	       moveman("right");

	    }
	    else if (e.keyCode == '32') {
	       // space bar
	       shoot();

	    }

	}







}



</script>